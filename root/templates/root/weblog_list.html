{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}وبلاگ | آکسون‌نگار{% endblock %}

{% block content %}

<!-- ================= CUSTOM CSS ================= -->
<style>
  /* 1. SEARCH BAR STYLING (GREY COLOR) */
  .search-area .input input {
      background-color: #f2f4f8 !important; /* Light Grey Background */
      border: 1px solid #e1e4e8;
      color: #333;
      transition: all 0.3s ease;
  }

  /* Darker border on focus */
  .search-area .input input:focus {
      background-color: #ffffff !important;
      border-color: #4e95ff; /* Highlight color (change as needed) */
      box-shadow: 0 0 0 3px rgba(78, 149, 255, 0.1);
  }

  .search-area {
    position: relative;
    z-index: 1000;
  }

  /* 2. DROPDOWN RESULTS BOX */
  .ajax-search-results {
    position: absolute;
    top: 115%; /* Pushed slightly down */
    right: 0;
    left: 0;
    background-color: #ffffff;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    border-radius: 12px;
    overflow: hidden;
    display: none; /* Hidden by default */
    border: 1px solid #f0f0f0;
    padding: 5px 0;
    z-index: 0;
  }

  /* Individual Result Items */
  .search-result-item {
    display: flex;
    align-items: center;
    padding: 10px 15px;
    border-bottom: 1px solid #f9f9f9;
    transition: background 0.2s ease;
    text-decoration: none !important;
  }

  .search-result-item:last-child {
    border-bottom: none;
  }

  /* Hover Effect */
  .search-result-item:hover {
    background-color: #f7f9fc;
  }

  /* Thumbnail Image */
  .search-result-item img {
    width: 45px;
    height: 45px;
    object-fit: cover;
    border-radius: 8px;
    margin-left: 12px; /* RTL Spacing */
    border: 1px solid #eee;
  }

  /* Text Styling */
  .search-result-item span {
    font-size: 14px;
    color: #222;
    font-weight: 600;
    line-height: 1.5;
  }

  /* "No Results" Message */
  .no-result-msg {
    padding: 20px;
    text-align: center;
    color: #888;
    font-size: 14px;
  }
</style>

  <!--===== HERO AREA START =======-->
  <div class="pages-hero">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-6">
          <div class="main-headding">
            <h1>
              وبلاگ هوش مصنوعی آکسون‌نگار
            </h1>
            <p>
              جایی برای یادگیری، الهام و رشد در دنیای هوش مصنوعی و تولید محتوا.
              تازه‌ترین مقالات، نکات آموزشی و تحلیل‌های تخصصی را اینجا بخوانید.
            </p>
          </div>
        </div>
        <div class="col-lg-1"></div>

        <!-- ===== SEARCH COLUMN ===== -->
        <div class="col-lg-5">
          <!-- onsubmit="return false" prevents page reload on Enter key -->
          <form onsubmit="return false;">
            <div class="search-area">
              <div class="input">
                <input
                    id="ajax-search-input"
                    type="text"
                    placeholder="جستجوی مقالات..."
                    autocomplete="off"
                >
              </div>
              <div class="button">
                <!-- Removed type="submit" to rely purely on typing,
                     or you can keep it but prevent default behavior in JS -->
                <button type="button">
                  <i class="fa-regular fa-magnifying-glass"></i>
                </button>
              </div>

              <!-- CONTAINER FOR DROPDOWN RESULTS -->
              <div id="search-results-box" class="ajax-search-results">
                  <!-- Results will appear here -->
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
    <img alt="" class="hero-shape1" src="{% static 'img/shapes/common-hero-shape1.png' %}">
    <img alt="" class="hero-shape3" src="{% static 'img/shapes/common-hero-shape3.png' %}">
  </div>
  <!--===== HERO AREA END =======-->

 <!--===== BLOG AREA START =======-->
  <div class="blog-area-all" style="padding-top: 40px;">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="all-contact">
            <div class="tab-content" id="pills-tabContent">
              <div aria-labelledby="tab-contact1-tab" class="tab-pane fade show active" id="tab-contact1" role="tabpanel">
                <div class="all-boxs">
                  <div class="row">
                    <!--===== For loop =======-->
                      {% for weblog in page_obj %}
                        <div class="col-lg-6">
                          <div class="blog-box">
                            <div class="image">
                              <img alt="" src="{{ weblog.cover_image.url }}"/>
                            </div>
                            <div class="headding">
                              <div class="tags">
                                <a>
                                  <img alt="" src="{% static 'img/icons/blog2-icon1.png' %}"/>
                                  {{ weblog.created|jalali_human }}
                                </a>
                                <a>
                                  <img alt="" src="{% static 'img/icons/blog2-icon2.png' %}"/>
                                  {{ weblog.author.full_name }}
                                </a>
                              </div>
                              <h4>
                                <a href="{% url 'root:weblog-detail' weblog.slug %}">
                                    {{ weblog.title }}
                                </a>
                              </h4>
                              <p>
                                {{ weblog.what_you_read }}
                              </p>
                              <a class="learn" href="{% url 'root:weblog-detail' weblog.slug %}">
                                ادامه مطلب
                                <span>
                                  <i class="fa-regular fa-arrow-left"></i>
                                </span>
                              </a>
                            </div>
                          </div>
                        </div>
                      {% endfor %}
                    <!--===== For loop =======-->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="space30"></div>

    <div class="row">

<!--===== Pagination starts =======-->
      <div class="col-12 m-auto">
        <div class="theme-pagination text-center">
          {% if page_obj.has_other_pages %}
          <ul>
            {% if page_obj.has_previous %}
              <li><a href="?page={{ page_obj.previous_page_number }}"><i class="fa-solid fa-angle-right"></i></a></li>
            {% else %}
              <li class="disabled"><span><i class="fa-solid fa-angle-right"></i></span></li>
            {% endif %}

            {% for page_number in paginator.get_elided_page_range %}
              {% if page_number == paginator.ELLIPSIS %}
                <li><span class="ellipsis">...</span></li>
              {% else %}
                {% if page_obj.number == page_number %}
                  <li><a class="active" href="?page={{ page_number }}">{{ page_number }}</a></li>
                {% else %}
                  <li><a href="?page={{ page_number }}">{{ page_number }}</a></li>
                {% endif %}
              {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
              <li><a href="?page={{ page_obj.next_page_number }}"><i class="fa-solid fa-angle-left"></i></a></li>
            {% else %}
              <li class="disabled"><span><i class="fa-solid fa-angle-left"></i></span></li>
            {% endif %}
          </ul>
          {% endif %}
        </div>
        <div class="space30"></div>
      </div>
      <!--===== Pagination ends =======-->

    </div>
    </div>
  </div>
  <!--===== BLOG AREA END =======-->

  {% include 'includes/cta.html' %}


<!-- ================= JAVASCRIPT AJAX LOGIC ================= -->
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const searchInput = document.getElementById('ajax-search-input');
        const resultsBox = document.getElementById('search-results-box');
        let typingTimer;

        // --- Make sure you have created the URL in urls.py and the View in views.py ---
        const searchUrl = "{% url 'root:search-autocomplete' %}";

        searchInput.addEventListener('keyup', function() {
            const query = this.value.trim();

            // Debounce: Clear timer so we don't fire request while typing
            clearTimeout(typingTimer);

            if (query.length < 2) {
                resultsBox.style.display = 'none';
                resultsBox.innerHTML = '';
                return;
            }

            // Wait 300ms after typing stops to perform search
            typingTimer = setTimeout(() => {
                fetchResults(query);
            }, 300);
        });

        function fetchResults(query) {
            fetch(`${searchUrl}?q=${query}`)
            .then(response => response.json())
            .then(data => {
                resultsBox.innerHTML = ''; // Clear old

                if (data.results.length > 0) {
                    // Create Items
                    data.results.forEach(item => {
                        // Check if image exists (handle fallback if None)
                        let imgHtml = '';
                        if (item.image) {
                            imgHtml = `<img src="${item.image}" alt="cover">`;
                        } else {
                            // Placeholder icon if no image
                            imgHtml = `<img src="{% static 'img/icons/blog2-icon1.png' %}" alt="cover" style="opacity:0.5;">`;
                        }

                        const htmlItem = `
                            <a href="${item.url}" class="search-result-item">
                                ${imgHtml}
                                <span>${item.title}</span>
                            </a>
                        `;
                        resultsBox.innerHTML += htmlItem;
                    });
                } else {
                    // No Data Found
                    resultsBox.innerHTML = '<div class="no-result-msg">نتیجه‌ای یافت نشد</div>';
                }

                // Show Box
                resultsBox.style.display = 'block';
            })
            .catch(err => {
                console.error('Search Error:', err);
            });
        }

        // Close Dropdown on Click Outside
        document.addEventListener('click', function(event) {
            if (!searchInput.contains(event.target) && !resultsBox.contains(event.target)) {
                resultsBox.style.display = 'none';
            }
        });
    });
</script>

{% endblock %}